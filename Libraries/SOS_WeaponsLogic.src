// Sand of Siberia
// Weapons Logic
// by Serpent
// 14-11-2020
Export Function SOS_UnitDestroyed(un);
var i, eff, side;
begin
if GetWeapon(un) = ar_bio_bomb then
   begin
   // upgrade for 3 bio
   if GetTech(tech_bio3, GetSide(un)) = state_researched then
      eff := 70
   else
      eff := 30;

   ArtContamination(GetX(un), GetY(un), eff);
   end;
End;

Export Function SOS_UnitExtraDestroyed(un, killerSide, killerUnit);
begin

End;

Export Function SOS_Command(cmd);
begin

End;

On TargetableSAIL(cmd, unit, selectedunit, x, y) do
begin
if cmd = 255 and GetWeapon(unit) in [us_bulldozer, ru_bulldozer] and ValidHex(x, y) then
   CutTreeXYR(unit, x, y, 12);
End;

Function CutTreeXYR(bulldozer, x, y, r);
var i, min_x, min_y, max_x, max_y, _x, _y, list;
begin
if not bulldozer or not ValidHex(x, y) or not r then
   exit;

list := [];

if x - r < 0 then
   min_x := 0
else
   min_x := x - r;

if y - r < 0 then
   min_y := 0
else
   min_y := y - r;

max_x := x + r;
max_y := y + r;

for _x = min_x to max_x do
    for _y = min_y to max_y do
        begin
        if not ValidHex(_x, _y) then
           continue;

        if IsEnvironment(_x, _y) and IsEnvironmentDestroyable(_x, _y) then
           list := Insert(list, list + 1, [_x, _y]);
        end;

if not list then
   exit;

for i in list do
    AddTaskList(bulldozer, [['M', i[1], i[2], 0, 0, 0, 0]]);
End;